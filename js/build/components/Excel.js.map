{"version":3,"sources":["../../source/components/Excel.js"],"names":["Excel","createClass","displayName","propTypes","headers","PropTypes","arrayOf","string","initialData","getInitialState","data","props","sortby","descending","edit","search","_sort","e","column","target","cellIndex","state","slice","sort","a","b","setState","_showEditor","row","parseInt","dataset","cell","_save","preventDefault","input","firstChild","value","_preSearchData","_toggleSearch","_search","needle","toLowerCase","idx","searchdata","filter","toString","indexOf","_download","format","ev","contents","JSON","stringify","reduce","result","rowresult","replace","length","URL","window","webkitURL","blob","Blob","type","href","createObjectURL","download","render","_renderToolbar","_renderTable","bind","_renderSearch","map","_ignore","title","rowidx","content"],"mappings":"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","file":"Excel.js","sourcesContent":["import React from 'react';\r\n\r\nvar Excel = React.createClass({\r\n  displayName: 'Excel',\r\n  \r\n  propTypes: {\r\n    headers: React.PropTypes.arrayOf(\r\n      React.PropTypes.string\r\n    ),\r\n    initialData: React.PropTypes.arrayOf(\r\n      React.PropTypes.arrayOf(\r\n        React.PropTypes.string\r\n      )\r\n    ),\r\n  },\r\n\r\n  getInitialState: function() {\r\n    return {\r\n      data: this.props.initialData,\r\n      sortby: null,\r\n      descending: false,\r\n      edit: null, // [row index, cell index],\r\n      search: false,\r\n    };\r\n  },\r\n  \r\n  _sort: function(e) {\r\n    var column = e.target.cellIndex;\r\n    var data = this.state.data.slice();\r\n    var descending = this.state.sortby === column && !this.state.descending;\r\n    data.sort(function(a, b) {\r\n      return descending \r\n        ? a[column] < b[column]\r\n        : a[column] > b[column];\r\n    });\r\n    this.setState({\r\n      data: data,\r\n      sortby: column,\r\n      descending: descending,\r\n    });\r\n  },\r\n  \r\n  _showEditor: function(e) {\r\n    this.setState({edit: {\r\n      row: parseInt(e.target.dataset.row, 10),\r\n      cell: e.target.cellIndex,\r\n    }});\r\n  },\r\n  \r\n  _save: function(e) {\r\n    e.preventDefault();\r\n    var input = e.target.firstChild;\r\n    var data = this.state.data.slice();\r\n    data[this.state.edit.row][this.state.edit.cell] = input.value;\r\n    this.setState({\r\n      edit: null,\r\n      data: data,\r\n    });\r\n  },\r\n  \r\n  _preSearchData: null,\r\n  \r\n  _toggleSearch: function() {\r\n    if (this.state.search) {\r\n      this.setState({\r\n        data: this._preSearchData,\r\n        search: false,\r\n      });\r\n      this._preSearchData = null;\r\n    } else {\r\n      this._preSearchData = this.state.data;\r\n      this.setState({\r\n        search: true,\r\n      });\r\n    }\r\n  },\r\n  \r\n  _search: function(e) {\r\n    var needle = e.target.value.toLowerCase();\r\n    if (!needle) {\r\n      this.setState({data: this._preSearchData});\r\n      return;\r\n    }\r\n    var idx = e.target.dataset.idx;\r\n    var searchdata = this._preSearchData.filter(function (row) {\r\n      return row[idx].toString().toLowerCase().indexOf(needle) > -1;\r\n    });\r\n    this.setState({data: searchdata});\r\n  },\r\n  \r\n  _download: function (format, ev) {\r\n    var contents = format === 'json'\r\n      ? JSON.stringify(this.state.data)\r\n      : this.state.data.reduce(function(result, row) {\r\n          return result\r\n            + row.reduce(function(rowresult, cell, idx) {\r\n                return rowresult \r\n                  + '\"' \r\n                  + cell.replace(/\"/g, '\"\"')\r\n                  + '\"'\r\n                  + (idx < row.length - 1 ? ',' : '');\r\n              }, '')\r\n            + \"\\n\";\r\n        }, '');\r\n\r\n    var URL = window.URL || window.webkitURL;\r\n    var blob = new Blob([contents], {type: 'text/' + format});\r\n    ev.target.href = URL.createObjectURL(blob);\r\n    ev.target.download = 'data.' + format;\r\n  },\r\n  \r\n  render: function() {\r\n    return (\r\n      <div className=\"Excel\">\r\n        {this._renderToolbar()}\r\n        {this._renderTable()}\r\n      </div>\r\n    );\r\n  },\r\n  \r\n  _renderToolbar: function() {\r\n    return (\r\n      <div className=\"toolbar\">\r\n        <button onClick={this._toggleSearch}>Search</button>\r\n        <a onClick={this._download.bind(this, 'json')} \r\n          href=\"data.json\">Export JSON</a>\r\n        <a onClick={this._download.bind(this, 'csv')} \r\n          href=\"data.csv\">Export CSV</a>\r\n      </div>\r\n    );\r\n  },\r\n  \r\n  _renderSearch: function() {\r\n    if (!this.state.search) {\r\n      return null;\r\n    }\r\n    return (\r\n      <tr onChange={this._search}>\r\n        {this.props.headers.map(function(_ignore, idx) {\r\n          return <td key={idx}><input type=\"text\" data-idx={idx}/></td>;\r\n        })}\r\n      </tr>\r\n    );\r\n  },\r\n  \r\n  _renderTable: function() {\r\n    return (\r\n      <table>\r\n        <thead onClick={this._sort}>\r\n          <tr>{\r\n            this.props.headers.map(function(title, idx) {\r\n              if (this.state.sortby === idx) {\r\n                title += this.state.descending ? ' \\u2191' : ' \\u2193';\r\n              }\r\n              return <th key={idx}>{title}</th>;\r\n            }, this)\r\n          }</tr>\r\n        </thead>\r\n        <tbody onDoubleClick={this._showEditor}>\r\n          {this._renderSearch()}\r\n          {this.state.data.map(function (row, rowidx) {\r\n            return (\r\n              <tr key={rowidx}>{\r\n                row.map(function (cell, idx) {\r\n                  var content = cell;\r\n                  var edit = this.state.edit;\r\n                  if (edit && edit.row === rowidx && edit.cell === idx) {\r\n                    var content = (\r\n                      <form onSubmit={this._save}>\r\n                        <input type=\"text\" defaultValue={cell} />\r\n                      </form>\r\n                    );\r\n                  }\r\n                  return <td key={idx} data-row={rowidx}>{content}</td>;\r\n                }, this)}\r\n              </tr>\r\n            );\r\n          }, this)}\r\n        </tbody>\r\n      </table>\r\n    );\r\n  }\r\n});\r\n\r\nexport default Excel"]}